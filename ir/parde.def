
class Tofino_ParserMatch {
  match_t                     value;
  int                         shift;
  inline Vector<Expression>   stmts;
  Tofino_ParserState          next;
  ParserException             except;
#noconstructor
#emit
  Tofino_ParserMatch(uintmax_t v, uintmax_t m, const Vector<Expression> &e)
  : value(~v&m, v&m), shift(0), stmts(e), next(0), except(0) {}
#end
}

class Tofino_ParserState {
  cstring                               name;
  inline Vector<Expression>             select;
  inline Vector<Tofino_ParserMatch>     match;
#noconstructor
#emit
  const IR::Parser *p4state; /* informational only! not visited or compared for equal */
  explicit Tofino_ParserState(const IR::Parser *);
#end
}

class Tofino_Parser {
  gress_t                       gress;
  Tofino_ParserState            start;
#noconstructor
#emit
  Tofino_Parser(gress_t gr, const Tofino_ParserState *s) : gress(gr), start(s) {}
#end
#apply
}

class Tofino_Deparser {
  gress_t               gress;
  Parser                start;
#noconstructor
#emit
  Tofino_Deparser(gress_t gr, const Tofino_Parser *s)
  : gress(gr), start(s && s->start ? s->start->p4state : 0) {}
#end
#apply
}
