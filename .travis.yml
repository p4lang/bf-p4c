services:
- docker
env:
  matrix:
  - MAKEFLAGS="-j2"
  - DOCKER_USERNAME="bfndocker"

before_install:
# - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
# get token to be able to talk to Docker Hub
TOKEN=$(curl -s -H "Content-Type: application/json" -X POST -d '{"username": "'${DOCKER_USERNAME}'", "password": "'${DOCKER_PASSWORD}'"}' https://hub.docker.com/v2/users/login/ | jq -r .token)

install:
- docker build -t bf-p4c-compilers .

script:
- docker run -w /bfn/bf-p4c-compilers/build/p4c -e MAKEFLAGS bf-p4c-compilers ctest -R cpplint
- docker run -w /bfn/bf-p4c-compilers/build/p4c -e MAKEFLAGS bf-p4c-compilers -L tofino -LE XFAIL

addons:
  jwt:
    secure: cF427U9IfXu0ia4En1zhHncNBo5toVkvwmlmm2gUVzgr0rxpRrhvnGceQ5eUjZyLnJP8PiFX38Eu9BdTme0SLyvgMnUOQVkoM0FVJEMI2cOldfcbBRt+nGORq6iQBb7OhPstf01vBKj3Qs8wmJyp7r0iJHINOPWhvWT02JOgfiKAY+h+iOzSoQx91Xh4lVvpZ+g6ziEYMif/sRAgeOYhcbceYxGKGxBDw6RTprzNsEjqSSGqVu1ZiGsgJoKUGxzCe9dBtpv3lgs87NJBkdFPMXLsqNum5cF14K+TxIWKZrhHlHqrBx3csKvLW6MtALQvy8eeRa/W2yeNNX6H/BVDNmcmRUrXH9SUUo3h77hX8T+4anfdmQLi1rxtmwgcTjU4JwrT1ikHqa13eAsOLvLcCfkkYEW5x/1kb3L1kVRX6yRqg4aOsiEA+LmT679W0wws9UvZYGUGtxIE8oIVv/dPxTZmXxXpB3a2lUvY5Rwfgew+Twck7tmuTaceyPJer++7PfvIppU1hDhTUskar0t8cu+IsXU15IcXJJNPUsYcJc4mC84jHlmYL9qL8q+FudOaSUzd4/IGIB2TD98j4Q5+TuLK+QfC2YJgG0ZYzwEhSFgO7TgIHo2dTHzG9VMwps2D1d6HvYim8AWG28yWbSyeqds4S1fVjpdhcNbO38XDQ0w=
