####### Tofino back-end

tofino_ir_SOURCES = \
	backends/tofino/ir/dbprint-tofino.cpp \
	backends/tofino/ir/mau.cpp \
	backends/tofino/ir/parde.cpp

ir_SOURCES += $(tofino_ir_SOURCES)

tofino_backend_SOURCES = \
	$(tofino_ir_SOURCES) \
	backends/tofino/common/asm_output.cpp \
	backends/tofino/common/copy_header_eliminator.cpp \
	backends/tofino/common/copy_header_eliminator.h \
	backends/tofino/common/extract_maupipe.cpp \
	backends/tofino/common/extract_maupipe.h \
	backends/tofino/common/field_defuse.cpp \
	backends/tofino/common/field_defuse.h \
	backends/tofino/common/phv.cpp \
	backends/tofino/common/phv.h \
	backends/tofino/mau/asm_output.cpp \
	backends/tofino/mau/asm_output.h \
	backends/tofino/mau/default_next.h \
	backends/tofino/mau/field_use.cpp \
	backends/tofino/mau/field_use.h \
	backends/tofino/mau/input_xbar.cpp \
	backends/tofino/mau/input_xbar.h \
	backends/tofino/mau/instruction_selection.cpp \
	backends/tofino/mau/instruction_selection.h \
	backends/tofino/mau/memories.cpp \
	backends/tofino/mau/memories.h \
	backends/tofino/mau/phv_constraints.cpp \
	backends/tofino/mau/phv_constraints.h \
	backends/tofino/mau/resource_estimate.cpp \
	backends/tofino/mau/resource_estimate.h \
	backends/tofino/mau/resource.h \
	backends/tofino/mau/split_gateways.cpp \
	backends/tofino/mau/split_gateways.h \
	backends/tofino/mau/table_dependency_graph.cpp \
	backends/tofino/mau/table_dependency_graph.h \
	backends/tofino/mau/table_layout.cpp \
	backends/tofino/mau/table_layout.h \
	backends/tofino/mau/table_mutex.cpp \
	backends/tofino/mau/table_mutex.h \
	backends/tofino/mau/table_placement.cpp \
	backends/tofino/mau/table_placement.h \
	backends/tofino/mau/table_seqdeps.cpp \
	backends/tofino/mau/table_seqdeps.h \
	backends/tofino/mau/table_summary.cpp \
	backends/tofino/mau/table_summary.h \
	backends/tofino/parde/asm_output.h \
	backends/tofino/parde/add_parde_metadata.h \
	backends/tofino/parde/add_parde_metadata.cpp \
	backends/tofino/parde/compute_shifts.h \
	backends/tofino/parde/deparser_output.cpp \
	backends/tofino/parde/extract_parser.cpp \
	backends/tofino/parde/extract_parser.h \
	backends/tofino/parde/gen_deparser.cpp \
	backends/tofino/parde/parser_output.cpp \
	backends/tofino/parde/split_header.cpp \
	backends/tofino/parde/split_header.h \
	backends/tofino/phv/asm_output.cpp \
	backends/tofino/phv/asm_output.h \
	backends/tofino/phv/create_thread_local_instances.cpp \
	backends/tofino/phv/create_thread_local_instances.h \
	backends/tofino/phv/header_fragment_creator.cpp \
	backends/tofino/phv/header_fragment_creator.h \
	backends/tofino/phv/phv.h \
	backends/tofino/phv/phv_allocate.cpp \
	backends/tofino/phv/phv_allocate.h \
	backends/tofino/phv/phv_fields.cpp \
	backends/tofino/phv/phv_fields.h \
	backends/tofino/test-tofino.cpp

ir_DEF_FILES += \
    $(srcdir)/backends/tofino/ir/tofino.def \
    $(srcdir)/backends/tofino/ir/mau.def \
    $(srcdir)/backends/tofino/ir/parde.def

bin_PROGRAMS += p4c-tofino
p4c_tofino_LDADD = -lgc libfrontend.a libp4ctoolkit.a 
p4c_tofino_SOURCES = $(tofino_backend_SOURCES) \
	backends/tofino/p4c-tofino.cpp

cpplint_FILES += $(tofino_backend_SOURCES)

# Tests

include $(srcdir)/testdata/v1_samples.am
include $(srcdir)/testdata/v1_errors.am

$(srcdir)/testdata/v1_samples.am: $(srcdir)/testdata/v1_samples/*.p4
	( echo '# autogenerated -- do not edit'; echo 'v1_sample_files = \'; \
	  cd $(srcdir); echo testdata/v1_samples/*.p4 | sed 's/ / \\\n/g' ) >$@

$(srcdir)/testdata/v1_errors.am: $(srcdir)/testdata/v1_errors/*.p4
	( echo '# autogenerated -- do not edit'; echo 'v1_error_files = \'; \
	  cd $(srcdir); echo testdata/v1_errors/*.p4 | sed 's/ / \\\n/g' ) >$@

TESTS += $(v1_sample_files) $(v1_error_files)
