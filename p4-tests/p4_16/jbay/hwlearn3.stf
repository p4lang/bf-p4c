
# setup the translation of predicate to learning action
add process_dleft_result 16 learn_pred:0b1*************** old_flow()
add process_dleft_result 15 learn_pred:0b**1************* old_flow()
add process_dleft_result 14 learn_pred:0b****1*********** old_flow()
add process_dleft_result 13 learn_pred:0b******1********* old_flow()
add process_dleft_result 12 learn_pred:0b********1******* old_flow()
add process_dleft_result 11 learn_pred:0b**********1***** old_flow()
add process_dleft_result 10 learn_pred:0b************1*** old_flow()
add process_dleft_result  9 learn_pred:0b**************1* old_flow()
add process_dleft_result  8 learn_pred:0b*1************** old_flow()
add process_dleft_result  7 learn_pred:0b*****1********** old_flow()
add process_dleft_result  6 learn_pred:0b*********1****** old_flow()
add process_dleft_result  5 learn_pred:0b*************1** old_flow()
add process_dleft_result  4 learn_pred:0b***1************ new_flow()
add process_dleft_result  3 learn_pred:0b***********1**** new_flow()
add process_dleft_result  2 learn_pred:0b*******1******** new_flow()
add process_dleft_result  1 learn_pred:0b***************1 failed_overflow()
add process_dleft_result  0 learn_pred:0 cuckoo_hit()

#prime the fid fifo with some fids.
packet 4 00000000000a 000000000000 ffff 000000000000
packet 4 00000000000b 000000000000 ffff 000000000000
packet 4 00000000000c 000000000000 ffff 000000000000
packet 4 00000000000d 000000000000 ffff 000000000000
packet 4 00000000000e 000000000000 ffff 000000000000
packet 4 00000000000f 000000000000 ffff 000000000000
packet 4 000000000010 000000000000 ffff 000000000000
packet 4 000000000011 000000000000 ffff 000000000000

expect 3  # packets come out port 3

#        | ethernet header            | | IPv4 header                                  | | UDP header      | | payload ...
#        dstAddr      srcAddr      type VL   len  id       ttl    csum                 |  sp   dp  len     | |
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0065 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0065 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0065 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(10) lo = 3

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0066 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0066 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(11) lo = 2

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0065 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(10) lo = 4

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0067 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0067 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0067 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(12) lo = 3

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0068 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0068 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(13) lo = 2

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0069 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0069 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0069 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(14) lo = 3

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 006a 0010 0000 000102030405060708090a0b0c0d0e0f
packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 006a 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(15) lo = 2

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0065 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(10) lo = 5

add cuckoo_match src_addr:0x01020304 dst_addr:0x0a000002 protocol:0x11 src_port:0x0064 dst_port:0x0065 match_flow(fid:10)

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 0065 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(10) lo = 6

packet 1 aaaaaaaaaaaa bbbbbbbbbbbb 0800 4500 002c 0000 0065 40 11 6c55 01020304 0a000002 0064 006b 0010 0000 000102030405060708090a0b0c0d0e0f
wait
check_register flow_counter(16) lo = 1

