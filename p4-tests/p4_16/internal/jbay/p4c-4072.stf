add SwitchIngressParser.$PORT_METADATA ingress_port:8 \
    set_port_metadata(port_lag_index:6, port_lag_label:0)

add SwitchIngress.pkt_validation.validate_ip 10 arp.$valid:0 ipv4.$valid:1 ipv6.$valid:0 \
    flags.ipv4_checksum_err:0 ipv4.version:4  ipv4.ihl:5 ipv4.flags:* \
    ipv4.frag_offset:* ipv4.ttl:* ipv4.src_addr:* ipv6.version:* ipv6.hop_limit:* \
    ipv6.src_addr:* valid_ipv4_pkt(ip_frag:0, is_link_local:0)

add SwitchIngress.pkt_validation.validate_ethernet 10 vlan_tag$0.$valid:0  \
    src_addr:* dst_addr:* valid_pkt_untagged(pkt_type:0)

add SwitchIngress.ingress_port_mapping.port_mirror.port_mirror port:8 \
    set_mirror_id(session_id:0 meter_index:1)

add SwitchIngress.ingress_port_mapping.port_mapping port:8 \
    set_port_properties(exclusion_id:0 learning_mode:0 trust_mode:0 qos_group:0 \
        color:0 tc:0 meter_index:0 sflow_session_id:0 mac_pkt_class:0)

add SwitchIngress.ingress_port_mapping.port_vlan_to_bd_mapping 10 \
    vlan_tag$0.$valid:0 vlan_tag$0.vid:* ig_md.port_lag_index:* \
    set_bd_properties(1 bd:10 vrf:0 bd_label:0 stp_group:0 learning_mode:0 \
        ipv4_unicast_enable:1 ipv4_multicast_enable:0 igmp_snooping_enable:0 \
        ipv6_unicast_enable:1 ipv6_multicast_enable:0 mld_snooping_enable:0 \
        mrpf_group:0 zone:0)

add SwitchIngress.bd_stats.bd_stats bd:10 pkt_type:0 count()
add SwitchIngress.ppg_stats.ppg port:8 icos:0 count()
add SwitchIngress.dmac.dmac 8 bd:10 dst_addr:0x111111111 dmac_hit(port_lag_index:7)
add SwitchIngress.ingress_mirror_meter.meter_index meter_index:1 set_meter(index:1)
add SwitchIngress.ingress_mirror_meter.meter_action color:0 meter_index:1 \
    SwitchIngress.ingress_mirror_meter.mirror_and_count()

add SwitchIngress.lag.lag port_lag_index:7 set_lag_port(meter_pfe:0x800000)
selector lag_selector 0 add 4
add lag_action_profile 4 set_lag_port(port:9)


add SwitchEgress.egress_port_mapping.port_mirror.port_mirror port:9 NoAction()
add SwitchEgress.egress_port_mapping.port_mapping port:9 \
    port_normal(port_lag_index:7, port_lag_label:0 qos_group:0)

add SwitchEgress.queue.queue port:9 qid:0 count()

expect 9 00 01 11 11 11 11 00 00  11 11 11 11 08 00 45 00 \
         00 56 00 01 00 00 40 11  af ec c0 a8 00 01 0a 00 \
         00 01 04 d2 00 50 00 42  00 52 00 01 02 03 04 05 \
         06 07 08 09 0a 0b 0c 0d  0e 0f 10 11 12 13 14 15 \
         16 17 18 19 1a 1b 1c 1d  1e 1f 20 21 22 23 24 25 \
         26 27 28 29 2a 2b 2c 2d  2e 2f 30 31 32 33 34 35 \
         36 37 38 39

packet 8 00 01 11 11 11 11 00 00 11 11 11 11 08 00 45 00 \
         00 56 00 01 00 00 40 11 af ec c0 a8 00 01 0a 00 \
         00 01 04 d2 00 50 00 42 00 52 00 01 02 03 04 05 \
         06 07 08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 \
         16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 \
         26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 \
         36 37 38 39
