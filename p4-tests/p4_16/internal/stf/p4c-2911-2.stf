# Default action forwards out port 2
add set_port hdr.data.f1:0x10000001 act(port:2)
add set_bridged hdr.data.f1:0x10000001 set_bmd()
add update_ingress_counter hdr.data.f1:0x10000001 update() = A
add update_ingress_counter2 hdr.data.f1:0x10000001 update2(idx:1)
add update_egress_counter hdr.data.f1:0x10000001 update() = B
add update_egress_counter2 hdr.data.f1:0x10000001 update2(idx:1)

#        f1       f2       h1   b1 b2 b2
packet 0 10000001 00000002 f654 55 66 77
expect 2 10000001 00000002 f654 11 22 77
packet 0 10000001 00000002 f654 55 66 77
expect 2 10000001 00000002 f654 11 22 77

wait

# NOTES:
# STF adds a 4-byte ethernet trailer by default.
# Total Size of 1 Packet (Bytes) = 13 (Header) + 4 (Eth trailer)
#                                = 17
# With new adjust_byte_count method call optional argument this value is
# subtracted through p4
#

# Ingress Counters Check
check_counter ICounterDirect($A) packets == 2
check_counter ICounterDirect($A) bytes == 26

check_counter ICounter(1) packets == 2
check_counter ICounter(1) bytes == 26

# Egress Counters Check
check_counter ECounterDirect($B) packets == 2
check_counter ECounterDirect($B) bytes== 26

check_counter ECounter(1) packets == 2
check_counter ECounter(1) bytes == 26

