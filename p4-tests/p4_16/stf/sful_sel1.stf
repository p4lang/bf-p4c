
add update_output data.b3:1 set_port_up()
add update_output data.b3:2 set_port_down()
#need to insert entries in the select_output action data table -- no support in STF yet
#FIXME -- need explicit set of pfe to trigger selector -- harness should do that automatically,
#but how to tell that the action needs it?
add select_output data.b1:0 set_output(meter_pfe:0x800000)
add sel_profile 2 set_output(port:2)
add sel_profile 3 set_output(port:3)

# initial set -- selector has just port 2 up
expect 0 01010101 02020202 03030303 04040404 00 01 01 02
packet 0 01010101 02020202 03030303 04040404 00 01 01 02

expect 2 01010101 02020202 03030001 04040404 00 00 01 02
expect 2 01010101 02020202 03030002 04040404 00 00 01 02
expect 2 01010101 02020202 03030003 04040404 00 00 01 02
expect 2 01010101 02020202 03030004 04040404 00 00 01 02
packet 0 01010101 02020202 03030001 04040404 00 00 01 02
packet 0 01010101 02020202 03030002 04040404 00 00 01 02
packet 0 01010101 02020202 03030003 04040404 00 00 01 02
packet 0 01010101 02020202 03030004 04040404 00 00 01 02

wait

# add port 3 to the selector and remove port 2
expect 0 01010101 02020202 03030303 04040404 00 01 01 03
packet 0 01010101 02020202 03030303 04040404 00 01 01 03
expect 0 01010101 02020202 03030303 04040404 00 01 02 02
packet 0 01010101 02020202 03030303 04040404 00 01 02 02

expect 3 01010101 02020202 03030011 04040404 00 00 01 02
expect 3 01010101 02020202 03030012 04040404 00 00 01 02
expect 3 01010101 02020202 03030013 04040404 00 00 01 02
expect 3 01010101 02020202 03030014 04040404 00 00 01 02
packet 0 01010101 02020202 03030011 04040404 00 00 01 02
packet 0 01010101 02020202 03030012 04040404 00 00 01 02
packet 0 01010101 02020202 03030013 04040404 00 00 01 02
packet 0 01010101 02020202 03030014 04040404 00 00 01 02
