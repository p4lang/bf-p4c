
#FIXME -- need explicit set of pfe to trigger selector -- harness should do that automatically
#but how to know when?
# currently meter_addr, meter_pfe, and action_addr  are 'raw' bus addresses, so need to include
# the subword shifts, even though those bits will end up not being stored in the match word
# overhead; it is assumed the default bits from the compiler will be the right thing.
add select_output data.b1:0 set_b2(meter_addr:0, meter_pfe:0x800000, action_addr:0)
add select_output data.b1:4 set_b2(meter_addr:0x200, meter_pfe:0x800000, action_addr:0x200)

$(for val in $(seq 0 255); do printf "add ap %d set_b2(v:%d);" $val $val; done)

selector sel_profile 0 add 17 19 21 23
selector sel_profile 4 add 0 2 4 6 

# initial set -- selector has just port 2 up
expect 1 01010101 02020202 03030001 04040404 00 .0001***1 01 02
expect 1 01010101 02020202 03030012 04040404 00 .0001***1 01 02
expect 1 01010101 02020202 03030123 04040404 00 .0001***1 01 02
expect 1 01010101 02020202 03031234 04040404 00 .0001***1 01 02
expect 1 01010101 02020202 03032345 04040404 00 .0001***1 01 02
expect 1 01010101 02020202 03033456 04040404 00 .0001***1 01 02
packet 1 01010101 02020202 03030001 04040404 00 00 01 02
packet 1 01010101 02020202 03030012 04040404 00 00 01 02
packet 1 01010101 02020202 03030123 04040404 00 00 01 02
packet 1 01010101 02020202 03031234 04040404 00 00 01 02
packet 1 01010101 02020202 03032345 04040404 00 00 01 02
packet 1 01010101 02020202 03033456 04040404 00 00 01 02

expect 1 01010101 02020202 03030001 04040404 01 00 ff 02
packet 1 01010101 02020202 03030001 04040404 01 00 01 02

expect 1 01010101 02020202 03030001 04040404 04 .1000***0 01 02
expect 1 01010101 02020202 03030012 04040404 04 .1000***0 01 02
expect 1 01010101 02020202 03030123 04040404 04 .1000***0 01 02
expect 1 01010101 02020202 03031234 04040404 04 .1000***0 01 02
expect 1 01010101 02020202 03032345 04040404 04 .1000***0 01 02
expect 1 01010101 02020202 03033456 04040404 04 .1000***0 01 02
packet 1 01010101 02020202 03030001 04040404 04 00 01 02
packet 1 01010101 02020202 03030012 04040404 04 00 01 02
packet 1 01010101 02020202 03030123 04040404 04 00 01 02
packet 1 01010101 02020202 03031234 04040404 04 00 01 02
packet 1 01010101 02020202 03032345 04040404 04 00 01 02
packet 1 01010101 02020202 03033456 04040404 04 00 01 02

