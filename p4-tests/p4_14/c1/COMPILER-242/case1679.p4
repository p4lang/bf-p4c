// Copyright (c) 2016 Arista Networks, Inc.  All rights reserved.
// Arista Networks, Inc. Confidential and Proprietary.
// By accepting and/or using this Arista Software, Barefoot Networks,
// Inc., ("Barefoot") agrees to use this Arista Software for the sole
// purpose of debugging Barefoot's software products only. Barefoot
// further agrees not to reverse-engineer or de-obfuscate this Arista
// Software.

#ifndef HEADERS_H4
#define HEADERS_H4

header_type FAsvCS {
	fields { 
	BdCqYI : 7;
	baGnNU : 9;
	naEwMt : 3;
	sTBZCx : 1;
	PcwCyQ : 1;
	TqMdKU : 3;
	lhsyBk : 5;
	cQvBHw : 3;
	zYZfLl : 3;
	nEhvAq : 1;
	eLEiQw : 2;
	epINPE : 1;
	SorGwc : 1;
	QBLjQt : 16;
	MxzGvd : 16;
	FDDTQt : 3;
	RotuII : 13;
	cGAuem : 3;
	IWwgbG : 13;
	dtwNQw : 16;
	GIuozf : 7;
	YvnWvO : 9;
	KuGHje : 16;
	}
}

header_type hdeiBN {
	fields { 
	SvUXup : 6;
	xcvBoh : 10;
	}
}

header_type hxpAPJ {
	fields { 
	sTSMPg : 7;
	PAEpdT : 9;
	oCqGfy : 5;
	PlVGMU : 19;
	oHOpeo : 6;
	RClgpY : 2;
	hwfBTw : 32;
	PwbmGI : 5;
	jsgRBp : 19;
	CzKMDf : 6;
	bdPzBi : 2;
	JlqTaO : 8;
	tuGxgm : 32;
	aSBwpd : 16;
	xmbJmB : 7;
	eqVHmA : 1;
	WyMriy : 3;
	taCXxF : 5;
	omGknl : 5;
	aeeYrF : 3;
	WJbTGf : 7;
	yFbHYb : 1;
	GEBGIP : 16;
	}
}

header_type wNWVEF {
	fields { 
	Pggwqi : 6;
	FHoYaB : 10;
	zvgghx : 1;
	AsnoaA : 7;
	}
}

header_type aRZQhh {
	fields { 
	UtfvXW : 2;
	ZHAzXi : 1;
	YLXmsh : 1;
	qXbbyb : 1;
	RLNdeZ : 3;
	}
}

header_type guSqnb {
	fields { 
	jBgsFy : 12;
	PxQXWg : 12;
	dFMPOI : 12;
	nDtFVp : 12;
	IBXNtZ : 1;
	xCIqFT : 24;
	hKjgye : 24;
	RSLrrz : 24;
	QIxCXx : 24;
	pIQUaB : 2;
	AXgGyk : 1;
	DTDyic : 1;
	jijIMQ : 1;
	BwTtvP : 1;
	}
}

header_type VPGFkS {
	fields { 
	EzUaHZ : 8;
	uGjozA : 1;
	uaMZSu : 1;
	iNqMBP : 1;
	RnjqzX : 1;
	}
}

header_type rpvdAU {
	fields { 
	RWHfxc : 32;
	ybmlEl : 32;
	KSyVCP : 16;
	}
}

header_type TbHYAQ {
	fields { 
	RIevRy : 128;
	UUPqdB : 128;
	}
}

header_type RCWYVO {
	fields { 
	WpWIBS : 14;
	aDFfah : 1;
	OGAZaG : 1;
	SxlBOA : 13;
	}
}

header_type mYMhnE {
	fields { 
	PlcSkB : 8;
	}
}

header_type WpkNOl {
	fields { 
	IBpboJ : 24;
	SjPEmg : 24;
	OydOme : 24;
	bZBHws : 24;
	Lbgcji : 16;
	}
}

header_type UJNFaQ {
	fields { 
	yJSoRk : 3;
	ByWOJd : 1;
	bKQlQb : 12;
	jjMMLI : 16;
	}
}

header_type teszwH {
	fields { 
	fdZaOD : 4;
	AhYRHs : 4;
	PZWVQk : 8;
	PaAniD : 16;
	kymIpp : 16;
	bQmPZU : 3;
	YyzswN : 13;
	JAkbVf : 8;
	BHthJN : 8;
	ruQaTJ : 16;
	Vkxquf : 32;
	NkPqcV : 32;
	}
}

header_type xZGoIJ {
	fields { 
	behmhH : 4;
	kvdOGd : 8;
	bLvyFc : 20;
	QghAPV : 16;
	tfQaOP : 8;
	eAalEc : 8;
	IDNtJG : 128;
	HrEcYz : 128;
	}
}

header_type LvNiTF {
	fields { 
	tNOzSr : 16;
	DdLLJa : 16;
	hMEYZS : 16;
	RnAOyY : 16;
	}
}

header_type ChMpQB {
	fields { 
	yhpFaF : 16;
	HXGtah : 16;
	vqgMev : 8;
	KgEhwF : 8;
	YbakVx : 16;
	}
}

header_type cbNiss {
	fields { 
	ifCvZS : 8;
	CNdawH : 24;
	pZSyjJ : 24;
	aXgSBY : 8;
	}
}

#endif // HEADERS_H4

#ifndef PARSER_H4
#define PARSER_H4

header FAsvCS LgcRIY;
header hdeiBN Zhbhwa;
header hxpAPJ qltkWA;
header wNWVEF HxXWLI;
header aRZQhh JPvFgx;
header WpkNOl OGAwff;
header WpkNOl vQBhIB;
header UJNFaQ RCeMTB;
header UJNFaQ CXAneX;
header teszwH XKlCuY;
header teszwH XwLeqw;
header xZGoIJ BZzyQX;
header xZGoIJ KkUuiN;
header LvNiTF mJKpnm;
header cbNiss ReMSVq;
header ChMpQB jxruBM;
metadata guSqnb tHxLKe;
metadata RCWYVO YxcqTZ;
metadata rpvdAU NkoYaG;
metadata TbHYAQ TZJYtn;
metadata VPGFkS zOxPzX;
metadata mYMhnE DAONgH;

parser start { 
	return GCpcTj;
}

parser GCpcTj { 
	extract(OGAwff );
	set_metadata(tHxLKe.xCIqFT, OGAwff.IBpboJ );
	set_metadata(tHxLKe.hKjgye, OGAwff.SjPEmg );
	set_metadata(tHxLKe.RSLrrz, OGAwff.OydOme );
	set_metadata(tHxLKe.QIxCXx, OGAwff.bZBHws );
	return select( OGAwff.Lbgcji ) {
		0x8100 : kERnnN;
		0x0800 : ZBfdXg;
		0x86dd : HwAhMc;
		0x0806 : ihhcZZ;
		default : ingressProcessing;
	}
}

parser kERnnN { 
	extract(RCeMTB );
	return select( RCeMTB.jjMMLI ) {
		0x0800 : ZBfdXg;
		0x86dd : HwAhMc;
		0x0806 : ihhcZZ;
		default : ingressProcessing;
	}
}

parser ZBfdXg { 
	extract(XKlCuY );
	return select( XKlCuY.YyzswN, XKlCuY.AhYRHs, XKlCuY.BHthJN ) {
		0x00000511 : IEpHDt;
		default : ingressProcessing;
	}
}

parser HwAhMc { 
	extract(KkUuiN );
	return ingressProcessing;
}

parser ihhcZZ { 
	extract(jxruBM );
	return ingressProcessing;
}

parser IEpHDt { 
	extract(mJKpnm );
	return select( mJKpnm.DdLLJa ) {
		0x12b5 : WEpwHS;
		default : ingressProcessing;
	}
}

parser WEpwHS { 
	extract(ReMSVq );
	set_metadata(tHxLKe.pIQUaB, 0x1 );
	return select( ReMSVq.pZSyjJ ) {
		default : sNXzVW;
	}
}

parser sNXzVW { 
	extract(vQBhIB );
	return ingressProcessing;
}

#endif // PARSER_H4

#ifdef __TARGET_BMV2__
#define BMV2
#endif
#ifdef __TARGET_TOFINO__
#include <tofino/constants.p4>
#include <tofino/intrinsic_metadata.p4>
#include <tofino/primitives.p4>
#include <tofino/stateful_alu_blackbox.p4>
#else
#include "includes/tofino.p4"
#endif

action TNeyqd(fCnLMA,CKZhjB,cMiJVG,PEPqQR) { 
	modify_field(YxcqTZ.WpWIBS, fCnLMA );
	modify_field(YxcqTZ.aDFfah, CKZhjB );
	modify_field(YxcqTZ.SxlBOA, cMiJVG );
	modify_field(YxcqTZ.OGAZaG, PEPqQR );
}

action oDoDiF() { 
	modify_field(tHxLKe.DTDyic, 0x1 );
	modify_field(DAONgH.PlcSkB, 0x1 );
}

action heGnIt() { 
	modify_field(tHxLKe.jijIMQ, 0x1 );
	modify_field(tHxLKe.BwTtvP, 0x1 );
}

action lBAbwY() { 
	modify_field(tHxLKe.dFMPOI, RCeMTB.bKQlQb );
}

action NSzCvQ() { 
	modify_field(tHxLKe.IBXNtZ, 0x1 );
}

action tNoIui(tDVDRX,CzrSAo,jKuAKM,zvrvfA,XKAzdx) { 
	modify_field(zOxPzX.EzUaHZ, tDVDRX );
	modify_field(zOxPzX.uGjozA, CzrSAo );
	modify_field(zOxPzX.iNqMBP, jKuAKM );
	modify_field(zOxPzX.uaMZSu, zvrvfA );
	modify_field(zOxPzX.RnjqzX, XKAzdx );
}

action CigvAL(hnwZMj) { 
	modify_field(tHxLKe.jBgsFy, hnwZMj );
}

action vWyCJo(NdosAt) { 
	modify_field(tHxLKe.PxQXWg, NdosAt );
}

action YYBVRK() { 
	modify_field(tHxLKe.jBgsFy, YxcqTZ.SxlBOA );
}

action lPdoWi() { 
	modify_field(tHxLKe.dFMPOI, YxcqTZ.SxlBOA );
}

action vckvUK() { 
	no_op( );
}

action zRZBHS() { 
	modify_field(NkoYaG.RWHfxc, XwLeqw.Vkxquf );
	modify_field(NkoYaG.ybmlEl, XwLeqw.NkPqcV );
	modify_field(TZJYtn.RIevRy, BZzyQX.IDNtJG );
	modify_field(TZJYtn.UUPqdB, BZzyQX.HrEcYz );
	modify_field(tHxLKe.xCIqFT, vQBhIB.IBpboJ );
	modify_field(tHxLKe.hKjgye, vQBhIB.SjPEmg );
	modify_field(tHxLKe.RSLrrz, vQBhIB.OydOme );
	modify_field(tHxLKe.QIxCXx, vQBhIB.bZBHws );
}

action QVzCQs(vmpnDP) { 
	modify_field(tHxLKe.jBgsFy, vmpnDP );
}

action CpbDtS() { 
	modify_field(tHxLKe.pIQUaB, 0x0 );
	modify_field(tHxLKe.PxQXWg, YxcqTZ.WpWIBS );
	modify_field(NkoYaG.RWHfxc, XKlCuY.Vkxquf );
	modify_field(NkoYaG.ybmlEl, XKlCuY.NkPqcV );
	modify_field(TZJYtn.RIevRy, KkUuiN.IDNtJG );
	modify_field(TZJYtn.UUPqdB, KkUuiN.HrEcYz );
	modify_field(tHxLKe.xCIqFT, OGAwff.IBpboJ );
	modify_field(tHxLKe.hKjgye, OGAwff.SjPEmg );
	modify_field(tHxLKe.RSLrrz, OGAwff.OydOme );
	modify_field(tHxLKe.QIxCXx, OGAwff.bZBHws );
}

action kfudnb() { 
	modify_field(tHxLKe.jBgsFy, RCeMTB.bKQlQb );
}

table INOSeK {
	reads{
		ig_intr_md.ingress_port : exact;
	}
	actions{ 
		TNeyqd;
	}
	size : 288;
}

table JrMSBe {
	reads{
		OGAwff.IBpboJ : exact;
		OGAwff.SjPEmg : exact;
	}
	actions{ 
		NSzCvQ;
	}
	size : 64;
}

table UnqUFr {
	reads{
		OGAwff.IBpboJ : exact;
		OGAwff.SjPEmg : exact;
		XKlCuY.NkPqcV : exact;
		tHxLKe.pIQUaB : exact;
	}
	actions{ 
		zRZBHS;
		CpbDtS;
	}
	size : 1024;
}

table XzzeTs {
	reads{
		YxcqTZ.WpWIBS : ternary;
		RCeMTB : valid;
		RCeMTB.bKQlQb : ternary;
	}
	actions{ 
		YYBVRK;
		CigvAL;
		kfudnb;
	}
	size : 4096;
}

table KjYLTh {
	reads{
		XKlCuY.Vkxquf : exact;
	}
	actions{ 
		vWyCJo;
		oDoDiF;
	}
	size : 4096;
}

table WVyiva {
	reads{
		ReMSVq.pZSyjJ : exact;
	}
	actions{ 
		QVzCQs;
		heGnIt;
	}
	size : 4096;
}

table HIjCXW {
	reads{
		YxcqTZ.SxlBOA : exact;
	}
	actions{ 
		tNoIui;
	}
	size : 8092;
}

table EmgemB {
	reads{
		YxcqTZ.WpWIBS : exact;
		RCeMTB.bKQlQb : exact;
	}
	actions{ 
		tNoIui;
		vckvUK;
	}
	size : 1024;
}

table FTvKgb {
	reads{
		RCeMTB.bKQlQb : exact;
	}
	actions{ 
		tNoIui;
	}
	size : 4096;
}

table bsvkkV {
	
	actions{ 
		lBAbwY;
	}
	size : 1;
}

table whxSrZ {
	
	actions{ 
		lPdoWi;
	}
	size : 1;
}

control ingressProcessing { 
	if (ig_intr_md.resubmit_flag == 0x0) { 
		apply( INOSeK );

	}

	apply( JrMSBe );

	apply( UnqUFr ) {
		CpbDtS {
			if (YxcqTZ.OGAZaG == 0x1) { 
				apply( XzzeTs );

			}

			if (( valid( XKlCuY ) ) or ( valid( KkUuiN ) )) { 
				if ( valid( RCeMTB ) ) { 
					apply( EmgemB ) {
						vckvUK {
							apply( FTvKgb );
						}
					}

				} else { 
                                   apply( HIjCXW );
				}
			}

		}
		zRZBHS {
			apply( KjYLTh );

			apply( WVyiva );

		}
	}
	if ( valid( RCeMTB ) ) { 
		apply( bsvkkV );
	} else { 
                apply( whxSrZ );
        }

}

control egressProcessing { 
}
