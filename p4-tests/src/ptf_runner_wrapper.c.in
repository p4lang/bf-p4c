#include <assert.h>
#include <stdlib.h>
#include <string.h>
#include <sys/types.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
  char args[1024] = {0};
  size_t pos = 0;
  int i;
  for (i = 1; i < argc; i++) {
    size_t s = strnlen(argv[i], sizeof(args));
    // make sure we have space for space and terminating character
    if (s > sizeof(args) - 2 - pos) return 1;
    args[pos] = ' ';
    pos++;
    strcpy(&args[pos], argv[i]);
    pos += s;
    assert(args[pos] == 0);
  }

  char cmd[sizeof("@HARLYN_PTF_DRIVER@") + 1024] = {};
  strcat(cmd, "@HARLYN_PTF_DRIVER@");
  strcat(cmd, args);
  setuid(0);
  int status = system(cmd);
  if (WIFEXITED(status)) return WEXITSTATUS(status);
  if (WIFSIGNALED(status)) return -1;
  return 0;
}
