# -*- Python -*-
#
# Copyright (c) 2015-2017 Barefoot Networks, Inc.

# All Rights Reserved.

# NOTICE: All information contained herein is, and remains the property of
# Barefoot Networks, Inc. and its suppliers, if any. The intellectual and
# technical concepts contained herein are proprietary to Barefoot Networks, Inc.
# and its suppliers and may be covered by U.S. and Foreign Patents, patents in
# process, and are protected by trade secret or copyright law. Dissemination of
# this information or reproduction of this material is strictly forbidden unless
# prior written permission is obtained from Barefoot Networks, Inc.

# No warranty, explicit or implicit is provided, unless granted under a written
# agreement with Barefoot Networks, Inc.
#

from p4c_src.driver import BackendDriver
import p4c_src.barefoot as bfn

class Tofino2Backend(bfn.BarefootBackend):
    def __init__(self, target, arch, argParser):
        bfn.BarefootBackend.__init__(self, target, arch, argParser)

        # command options
        self.config_preprocessor("__TARGET_TOFINO__=2")
        self.config_compiler(self._target, self._arch, "__TARGET_TOFINO__=2")
        self.config_assembler("tofino2")
        self.add_command_option('assembler', '--pipe0')
        self.add_command_option('assembler', '--singlewrite')

# Tofino2 Native Architecture
tofino2_native_target1 = Tofino2Backend('tofino2', 'tna', argParser)
config.target.append(tofino2_native_target1)
tofino2_native_target2 = Tofino2Backend('tofino2', 't2na', argParser)
config.target.append(tofino2_native_target2)

# Tofino2 V1model architecture -- still need to support for P4_14
tofino2_v1model_target = Tofino2Backend('tofino2', 'v1model', argParser)
config.target.append(tofino2_v1model_target)

# PSA implementation on Tofino2
psa_target = BackendDriver('tofino2', 'psa')
psa_target.add_command('none', \
	'/bin/echo "target ' + str(psa_target) + ' not yet implemented"')
psa_target.enable_commands(['none'])
config.target.append(psa_target)
